<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Sample Three.js</title>

    <script src="js/three.min.js"></script>

</head>
<body>
<script>
    var camera;
    var scene;
    var renderer;

    var clock;
    var deltaTime;

    var particleSystem;
    var haloOpacity = 0.1;

    init(); // initialize場景
    animate(); //場景更新

    function init() {

        clock = new THREE.Clock(true); //計時器

        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 1, 1000);
        camera.position.set(0, 10, 50);

        renderer = new THREE.WebGLRenderer();
        renderer.setSize( window.innerWidth, window.innerHeight );
        renderer.setClearColor(0x000022,1.0);//設定背景色
        document.body.appendChild( renderer.domElement );//將著色器加入body

        window.addEventListener( 'resize', onWindowResize, false );//監聽畫面大小

        particleSystem = createParticleSystem();//在創建粒子系統後，先別直接加入場景，先return整個粒子系統，在指定給變數"particleSystem",方便後續操作
        particleSystem.position.set(0,5,0);


        scene.add(particleSystem);

        render();

    }

    function animate() {
        particleSystem.rotation.y += 0.01; // particleSystem 屬於 THREE.Points >> THREE.Points( geometry, material )

        deltaTime = clock.getDelta();
        haloOpacity += deltaTime*3;
        particleSystem.material.opacity = Math.sin(haloOpacity)*0.5+0.55; //  -1 < sin < 1，所以往上位移一半 0.5

        render();
        requestAnimationFrame( animate );
    }


    function render() {
        renderer.render( scene, camera );
    }


    function onWindowResize() {                                          //onWindowResize制式寫法
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize( window.innerWidth, window.innerHeight );
        render();
    }

    function createParticleSystem() {
        var sphere = new THREE.SphereGeometry(20, 50, 50); // 建立Geometry
        console.log(sphere.vertices[0].y);


        // Create the material that will be used to render each vertex of the geometry
        // 建立粒子材質 PointsMaterial
        var particleMaterial = new THREE.PointsMaterial({
                    color: 0xffffff,
                    size: 0.5,
                    map: THREE.ImageUtils.loadTexture("images/particle.png"),
                    blending: THREE.AdditiveBlending, //融合場景
                    transparent: true,
                    opacity:haloOpacity // 讓opacity可受外部調整
                });

        // Create the particle system
        particleSystem = new THREE.Points(sphere, particleMaterial);
        console.log(particleSystem.geometry.vertices.length);




        return particleSystem;
    }


</script>


</body>



</html>
